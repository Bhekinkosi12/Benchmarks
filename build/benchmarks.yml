# Orchestrates all benchmarks

variables:
  - template: job-variables.yml
  - name: session
    value: $(Build.BuildNumber)
  - name: buildId
    value: $(Build.BuildId)
  - name: buildNumber
    value: $(Build.BuildNumber)
  - name: am
    value: $[lt(format('{0:HH}', pipeline.startTime), 12)]
  - name: pm
    value: $[ge(format('{0:HH}', pipeline.startTime), 12)]

jobs:

- job: CrossGen_Linux
  displayName: CrossGen2
  pool: server
  timeoutInMinutes: 60
  condition: and(succeededOrFailed(), eq(variables['am'], true))
  strategy:
    maxParallel: 1
    matrix:
      Intel_Linux:
        profile: aspnet-citrine-lin
      Arm_Linux:
        profile: aspnet-citrine-arm
  steps:
  - template: crossgen2-scenarios.yml
    parameters:
      warmup: 15
      duration: 15
      connection: ASP.NET Benchmarks Queue
      profile: $(profile)

- job: CrossGen_Windows
  displayName: CrossGen2
  pool: server
  timeoutInMinutes: 120
  dependsOn: CrossGen_Linux
  condition: and(succeededOrFailed(), eq(variables['am'], true))
  strategy:
    maxParallel: 1
    matrix:
      Intel_Windows:
        profile: aspnet-citrine-win
      Amd_Linux:
        profile: aspnet-citrine-amd
  steps:
  - template: crossgen2-scenarios.yml
    parameters:
      warmup: 15
      duration: 15
      connection: ASP.NET Benchmarks Mono Queue
      profile: $(profile)
